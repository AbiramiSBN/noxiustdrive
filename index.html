<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NoxiustDrive</title>
  <style>
    :root{
      /* tuned for dark wallpaper */
      --glass: rgba(10,14,24,.62);
      --glass2: rgba(14,20,34,.56);
      --panel: rgba(12,16,28,.48);
      --panel2: rgba(255,255,255,.055);
      --border: rgba(255,255,255,.14);
      --border2: rgba(255,255,255,.20);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent:#60a5fa;
      --ok:#34d399;
      --danger:#fb7185;
      --font: system-ui, -apple-system, "Segoe UI Variable", "Segoe UI", Roboto, Arial, sans-serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --shadow: 0 24px 90px rgba(0,0,0,.70);
    }
    *{ box-sizing:border-box; }
    html, body { height:100%; }

    body{
      margin:0;
      overflow:hidden;
      font-family:var(--font);
      color:var(--text);

      /* FILE BROWSER WALLPAPER */
      background:
        linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.65)),
        url("pictures/wallpapers/wallpaper2.jpeg");
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
    }

    /* ===== FULLSCREEN APP ===== */
    .window{
      position:relative;
      width:100vw;height:100vh;
      display:flex;flex-direction:column;
      overflow:hidden;
    }

    /* ===== MICA / FROSTED PANEL LAYER =====
       - sits behind UI
       - makes text readable on wallpaper
    */
    .mica{
      position:absolute;
      inset:0;
      pointer-events:none;
      /* subtle highlight + vignette */
      background:
        radial-gradient(1200px 900px at 20% 15%, rgba(96,165,250,.10), transparent 55%),
        radial-gradient(900px 700px at 80% 20%, rgba(52,211,153,.06), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.55));
      backdrop-filter: blur(18px) saturate(140%);
      -webkit-backdrop-filter: blur(18px) saturate(140%);
      opacity: 1;
    }

    /* actual UI layer */
    .ui{
      position:relative;
      z-index:1;
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
      background: var(--glass);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
    }

    .titlebar{
      height:46px;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 10px 0 12px;
      background: rgba(0,0,0,.34);
      border-bottom:1px solid var(--border);
      user-select:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .title-left{ display:flex; align-items:center; gap:10px; }
    .appicon{
      width:26px;height:26px;border-radius:8px;
      display:grid;place-items:center;
      background:rgba(96,165,250,.18);
      border:1px solid rgba(96,165,250,.28);
      font-size:14px;
    }
    .apptitle{ display:flex; flex-direction:column; line-height:1.05; }
    .apptitle b{ font-size:.98rem; letter-spacing:.2px; }
    .apptitle span{ font-size:.78rem; color:var(--muted); }

    .winbtns{ display:flex; gap:8px; align-items:center; opacity:.85; }
    .dotbtn{
      width:12px;height:12px;border-radius:50%;
      background:rgba(255,255,255,0.22);
      border:1px solid rgba(255,255,255,0.14);
    }
    .dotbtn.close{ background: rgba(251,113,133,.38); border-color: rgba(251,113,133,.30); }

    .cmdbar{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;
      background: rgba(0,0,0,.22);
      border-bottom:1px solid var(--border);
      user-select:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn{
      appearance:none;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.07);
      color:var(--text);
      padding:8px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-size:.92rem;
      display:inline-flex; align-items:center; gap:8px;
      transition: background .12s, border-color .12s, transform .06s;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(255,255,255,.11); border-color: rgba(255,255,255,.26); }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }
    .btn.primary{
      border-color: rgba(96,165,250,.45);
      background: rgba(96,165,250,.22);
    }

    .pill{
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.07);
      color: var(--muted);
      font-size:.86rem;
    }
    .statusDot{
      width:10px;height:10px;border-radius:50%;
      background: var(--danger);
      box-shadow: 0 0 0 6px rgba(251,113,133,.12);
    }

    .addrrow{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      background: rgba(0,0,0,.14);
      border-bottom:1px solid var(--border);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .addr{
      flex:1;
      display:flex;align-items:center;gap:6px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.06);
      overflow:auto;
      scrollbar-width: thin;
      min-width:0;
      font-family: var(--mono);
      font-size:.9rem;
      color: rgba(255,255,255,.92);
    }
    .search{
      width: min(420px, 45vw);
      display:flex;align-items:center;gap:8px;
      padding:8px 10px;
      border-radius: 12px;
      border:1px solid var(--border2);
      background: rgba(255,255,255,.06);
    }
    .search input{
      width:100%;
      border:0; outline:none;
      background:transparent;
      color:var(--text);
      font-size:.92rem;
    }

    .body{ flex:1; display:flex; min-height:0; }

    .left{
      width: 310px;
      background: rgba(0,0,0,.18);
      border-right:1px solid var(--border);
      padding:10px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .panehdr{
      display:flex;align-items:center;justify-content:space-between;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color: var(--muted);
      font-size:.84rem;
      letter-spacing:.08em;
      text-transform: uppercase;
      user-select:none;
    }
    .tree{ overflow:auto; }
    .node{
      display:flex;align-items:center;gap:10px;
      padding:10px 10px;
      border-radius: 12px;
      cursor:pointer;
      border:1px solid transparent;
      user-select:none;
    }
    .node:hover{ background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.14); }
    .icon{
      width:30px;height:30px;border-radius:10px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
    }
    .label b{ display:block; font-size:.94rem; }
    .label span{ display:block; font-size:.78rem; color:var(--muted); }

    .main{
      flex:1;
      padding:12px;
      min-width:0;
      display:flex;
      flex-direction:column;
      min-height:0;
      gap:10px;
    }
    .list{
      flex:1;
      min-height:0;
      border:1px solid var(--border);
      border-radius: 14px;
      background: rgba(0,0,0,.16);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .listhead{
      display:grid;
      grid-template-columns: 1.55fr .75fr .85fr;
      padding:10px 12px;
      background: rgba(255,255,255,0.05);
      border-bottom:1px solid var(--border);
      color: var(--muted);
      font-size:.82rem;
      user-select:none;
    }
    .rows{
      overflow:auto;
      flex:1;
      outline:none;
    }
    .rows:focus{
      box-shadow: inset 0 0 0 2px rgba(96,165,250,.28);
    }
    .row{
      display:grid;
      grid-template-columns: 1.55fr .75fr .85fr;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,0.06);
      align-items:center;
      cursor:pointer;
      user-select:none;
      border-left:3px solid transparent;
    }
    .row:hover{ background: rgba(255,255,255,.07); }
    .row.selected{ background: rgba(96,165,250,.18); border-left-color: rgba(96,165,250,.78); }

    .cellname{ display:flex;align-items:center;gap:10px; min-width:0; }
    .fileicon{
      width:30px;height:30px;border-radius:10px;
      display:grid;place-items:center;
      background: rgba(96,165,250,.16);
      border:1px solid rgba(96,165,250,.22);
      flex:0 0 auto;
    }
    .nametext{ min-width:0; }
    .nametext b{
      display:block;
      overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    }
    .nametext span{
      display:block;
      font-size:.8rem;
      color:var(--muted);
      font-family: var(--mono);
      overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    }
    .type,.modified{ color: var(--muted); font-size:.9rem; }

    .details{
      width: 360px;
      background: rgba(0,0,0,.18);
      border-left:1px solid var(--border);
      padding:12px;
      min-height:0;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .preview{
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding:12px;
      min-height: 170px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
      user-select:none;
    }
    .bigicon{ font-size: 52px; }
    .preview small{
      position:absolute;
      bottom:10px; left:12px; right:12px;
      color: rgba(255,255,255,.78);
      font-size:.82rem;
      overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
      font-family: var(--mono);
    }
    .props{
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding:12px;
      overflow:auto;
      flex:1;
    }
    .props h3{ margin:0 0 10px 0; font-size:.95rem; }
    .kv{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap:8px 10px;
      font-size:.88rem;
    }
    .k{ color: var(--muted); }
    .v{ font-family: var(--mono); overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }

    .statusbar{
      height:34px;
      border-top:1px solid var(--border);
      background: rgba(0,0,0,.22);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 12px;
      color: var(--muted);
      font-size:.86rem;
      user-select:none;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    /* Context menu */
    .ctx{
      position: fixed;
      z-index: 10000;
      display:none;
      min-width: 170px;
      background: rgba(2,6,23,0.92);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 14px;
      box-shadow: 0 16px 50px rgba(0,0,0,0.65);
      padding: 6px;
      backdrop-filter: blur(16px);
      user-select:none;
    }
    .ctx button{
      width:100%;
      border:0;
      background: transparent;
      color: var(--text);
      padding: 10px 10px;
      border-radius: 10px;
      cursor:pointer;
      text-align:left;
      font-size: .92rem;
    }
    .ctx button:hover{ background: rgba(255,255,255,0.08); }
    .ctx button:disabled{ opacity:.45; cursor:not-allowed; }

    /* Lock screen (still wallpaper.jpeg) */
    .lock{
      position: fixed;
      inset:0;
      z-index: 99999;
      display:none;
      background:
        linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.65)),
        url("pictures/wallpapers/wallpaper.jpeg");
      background-size: cover;
      background-position: center;
      background-repeat:no-repeat;
      user-select:none;
      color: white;
    }
    .lock.show{ display:block; }
    .signin{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .signinCard{
      width:min(520px, calc(100vw - 44px));
      background: rgba(2,6,23,0.55);
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      padding: 18px;
    }
    .signinHead{ display:flex; align-items:center; gap:12px; margin-bottom: 14px; }
    .avatar{
      width:46px;height:46px;border-radius: 16px;
      display:grid;place-items:center;
      background: rgba(96,165,250,0.18);
      border: 1px solid rgba(96,165,250,0.25);
      font-size: 18px;
    }
    .signinTitle b{ display:block; font-size:1.08rem; }
    .signinTitle span{ display:block; color: rgba(255,255,255,.78); font-size:.88rem; }
    .inp{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
      color: white;
      outline:none;
      font-size: .96rem;
    }
    .inp:focus{ border-color: rgba(96,165,250,.75); }
    .err{ min-height: 18px; margin-top: 8px; font-size:.9rem; color: rgba(251,113,133,.95); }
    .signinBtns{ display:flex; justify-content:flex-end; gap:10px; margin-top: 12px; }
  </style>
</head>

<body>
  <div class="window">
    <div class="mica"></div>

    <div class="ui" id="ui">
      <div class="titlebar">
        <div class="title-left">
          <div class="appicon">üóÇÔ∏è</div>
          <div class="apptitle">
            <b>NoxiustDrive</b>
            <span id="subtitle">Unlocked</span>
          </div>
        </div>
        <div class="winbtns" aria-hidden="true">
          <div class="dotbtn"></div>
          <div class="dotbtn"></div>
          <div class="dotbtn close"></div>
        </div>
      </div>

      <div class="cmdbar">
        <button class="btn" id="openBtn" disabled>üìÇ Open</button>
        <button class="btn" id="refreshBtn">üîÑ Refresh</button>
        <div style="flex:1"></div>
        <div class="pill">
          <span class="statusDot" id="statusDot"></span>
          <span id="statusText">Locked</span>
        </div>
        <button class="btn primary" id="logoutBtn">üö™ Lock</button>
      </div>

      <div class="addrrow">
        <div class="addr" id="addr">/</div>
        <div class="search">üîé <input id="searchBox" placeholder="Search (filters list)"/></div>
      </div>

      <div class="body">
        <div class="left">
          <div class="panehdr"><span>This PC</span><span>Folders</span></div>
          <div class="tree" id="tree"></div>
        </div>

        <div class="main">
          <div class="list">
            <div class="listhead"><div>Name</div><div>Type</div><div>Date modified</div></div>
            <div class="rows" id="rows" tabindex="0" aria-label="File list"></div>
          </div>
        </div>

        <div class="details">
          <div class="panehdr"><span>Details</span><span>Preview + Properties</span></div>
          <div class="preview">
            <div class="bigicon" id="bigicon">üóÇÔ∏è</div>
            <small id="previewLabel">Select an item</small>
          </div>
          <div class="props">
            <h3>Properties</h3>
            <div class="kv" id="kv">
              <div class="k">Name</div><div class="v">‚Äî</div>
              <div class="k">Type</div><div class="v">‚Äî</div>
              <div class="k">URL</div><div class="v">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div class="statusbar">
        <div id="sbLeft">0 items</div>
        <div id="sbRight">Ready</div>
      </div>
    </div>
  </div>

  <div class="ctx" id="ctxMenu"><button id="ctxOpen" disabled>Open</button></div>

  <div class="lock show" id="lock">
    <div class="signin">
      <div class="signinCard">
        <div class="signinHead">
          <div class="avatar">üîí</div>
          <div class="signinTitle">
            <b>NoxiustDrive</b><span>Sign in</span>
          </div>
        </div>
        <input class="inp" id="user" placeholder="Username" autocomplete="username" />
        <div style="height:10px"></div>
        <input class="inp" id="pass" placeholder="Password" type="password" autocomplete="current-password" />
        <div class="err" id="msg"></div>
        <div class="signinBtns">
          <button class="btn primary" id="submitBtn">Unlock</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const EXPECTED_USER = "y8tireu";
  const SALT = "p9$V3!n2";
  // SHA256("y8tireu:051285:p9$V3!n2")
  const EXPECTED_HASH_HEX = "1007e61100fc2fae55839e2aba29000155e956343aeb1e4f67a792aa08cbb350";

  async function sha256Hex(input){
    const enc = new TextEncoder();
    const data = enc.encode(input);
    const digest = await crypto.subtle.digest("SHA-256", data);
    const bytes = new Uint8Array(digest);
    return Array.from(bytes).map(b => b.toString(16).padStart(2,"0")).join("");
  }

  // Root folders only (no fake file listings)
  const ROOT_FOLDERS = [
    { name:"Documents", url:"documents/", icon:"üìÑ" },
    { name:"Music",     url:"music/",     icon:"üéµ" },
    { name:"Pictures",  url:"pictures/",  icon:"üñºÔ∏è" },
    { name:"Videos",    url:"videos/",    icon:"üé¨" }
  ];

  const rowsEl = document.getElementById("rows");
  const searchBox = document.getElementById("searchBox");
  const openBtn = document.getElementById("openBtn");
  const bigicon = document.getElementById("bigicon");
  const previewLabel = document.getElementById("previewLabel");
  const kv = document.getElementById("kv");
  const sbLeft = document.getElementById("sbLeft");
  const sbRight = document.getElementById("sbRight");
  const addr = document.getElementById("addr");
  const tree = document.getElementById("tree");

  const ctxMenu = document.getElementById("ctxMenu");
  const ctxOpen = document.getElementById("ctxOpen");

  const lock = document.getElementById("lock");
  const msg = document.getElementById("msg");
  const userEl = document.getElementById("user");
  const passEl = document.getElementById("pass");
  const submitBtn = document.getElementById("submitBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const statusDot = document.getElementById("statusDot");
  const statusText = document.getElementById("statusText");
  const subtitle = document.getElementById("subtitle");

  let selectedIndex = -1;
  let filtered = [];

  function setLocked(locked){
    if(locked){
      lock.classList.add("show");
      statusText.textContent = "Locked";
      subtitle.textContent = "Locked";
      statusDot.style.background = "var(--danger)";
      statusDot.style.boxShadow = "0 0 0 6px rgba(251,113,133,.12)";
      // focus login
      setTimeout(()=>userEl.focus(), 50);
    }else{
      lock.classList.remove("show");
      statusText.textContent = "Unlocked";
      subtitle.textContent = "Unlocked";
      statusDot.style.background = "var(--ok)";
      statusDot.style.boxShadow = "0 0 0 6px rgba(52,211,153,.12)";
      // focus list
      setTimeout(()=>rowsEl.focus(), 50);
    }
  }

  function applyFilter(){
    const q = (searchBox.value || "").trim().toLowerCase();
    filtered = !q ? ROOT_FOLDERS : ROOT_FOLDERS.filter(x => x.name.toLowerCase().includes(q));
    if(filtered.length === 0) selectedIndex = -1;
    else if(selectedIndex < 0 || selectedIndex >= filtered.length) selectedIndex = 0;
  }

  function selectedItem(){
    if(selectedIndex < 0 || selectedIndex >= filtered.length) return null;
    return filtered[selectedIndex];
  }

  function updateDetails(){
    const it = selectedItem();
    openBtn.disabled = !it;
    ctxOpen.disabled = !it;

    if(!it){
      bigicon.textContent = "üóÇÔ∏è";
      previewLabel.textContent = "Select an item";
      kv.innerHTML = `<div class="k">Name</div><div class="v">‚Äî</div>
                      <div class="k">Type</div><div class="v">‚Äî</div>
                      <div class="k">URL</div><div class="v">‚Äî</div>`;
      sbRight.textContent = "Ready";
      return;
    }

    bigicon.textContent = it.icon;
    previewLabel.textContent = it.url;
    kv.innerHTML = `<div class="k">Name</div><div class="v" title="${it.name}">${it.name}</div>
                    <div class="k">Type</div><div class="v">File folder</div>
                    <div class="k">URL</div><div class="v" title="${it.url}">${it.url}</div>`;
    sbRight.textContent = "Folder selected";
  }

  function renderRows(){
    rowsEl.innerHTML = "";
    applyFilter();

    filtered.forEach((e, idx)=>{
      const row = document.createElement("div");
      row.className = "row" + (idx === selectedIndex ? " selected" : "");
      row.innerHTML = `
        <div class="cellname">
          <div class="fileicon">${e.icon}</div>
          <div class="nametext">
            <b>${e.name}</b>
            <span>${e.url}</span>
          </div>
        </div>
        <div class="type">File folder</div>
        <div class="modified">‚Äî</div>
      `;

      row.addEventListener("click", ()=>{
        selectedIndex = idx;
        hideCtx();
        renderRows();
      });

      /* ‚úÖ DOUBLE CLICK TO OPEN */
      row.addEventListener("dblclick", ()=>{
        selectedIndex = idx;
        hideCtx();
        openSelected();
      });

      row.addEventListener("contextmenu", (ev)=>{
        ev.preventDefault();
        selectedIndex = idx;
        renderRows();
        showCtx(ev.clientX, ev.clientY);
      });

      rowsEl.appendChild(row);
    });

    sbLeft.textContent = `${filtered.length} item${filtered.length===1?"":"s"}`;
    updateDetails();

    rowsEl.querySelectorAll(".row").forEach((r,i)=> r.classList.toggle("selected", i===selectedIndex));
  }

  function openSelected(){
    const it = selectedItem();
    if(!it) return;
    window.location.href = it.url; // real directory URL
  }

  function renderTree(){
    tree.innerHTML = "";
    ROOT_FOLDERS.forEach((f)=>{
      const n = document.createElement("div");
      n.className = "node";
      n.innerHTML = `<div class="icon">${f.icon}</div>
                     <div class="label"><b>${f.name}</b><span>${f.url}</span></div>`;
      n.addEventListener("click", ()=> window.location.href = f.url);
      tree.appendChild(n);
    });
  }

  // Context menu
  function showCtx(x,y){
    ctxMenu.style.display = "block";
    const pad=8;
    const w=ctxMenu.offsetWidth, h=ctxMenu.offsetHeight;
    ctxMenu.style.left = Math.max(pad, Math.min(x, innerWidth-w-pad)) + "px";
    ctxMenu.style.top  = Math.max(pad, Math.min(y, innerHeight-h-pad)) + "px";
    updateDetails();
  }
  function hideCtx(){ ctxMenu.style.display = "none"; }

  document.addEventListener("click", (ev)=>{
    if(!ev.target.closest(".ctx")) hideCtx();
  });
  document.addEventListener("contextmenu", (ev)=>{
    if(ev.target.closest(".ui")){
      ev.preventDefault();
      if(!ev.target.closest(".row")) hideCtx();
    }
  });
  window.addEventListener("resize", hideCtx);

  ctxOpen.addEventListener("click", ()=>{ hideCtx(); openSelected(); });
  openBtn.addEventListener("click", openSelected);
  document.getElementById("refreshBtn").addEventListener("click", ()=>{ hideCtx(); renderRows(); });

  // Keyboard: Enter opens; arrows navigate
  rowsEl.addEventListener("keydown", (ev)=>{
    if(filtered.length === 0) return;
    if(ev.key === "ArrowDown"){
      ev.preventDefault();
      selectedIndex = Math.min(filtered.length-1, selectedIndex + 1);
      renderRows();
    } else if(ev.key === "ArrowUp"){
      ev.preventDefault();
      selectedIndex = Math.max(0, selectedIndex - 1);
      renderRows();
    } else if(ev.key === "Enter"){
      ev.preventDefault();
      openSelected();
    }
  });

  searchBox.addEventListener("input", ()=>{
    selectedIndex = -1;
    hideCtx();
    renderRows();
  });

  // Lock / Unlock
  async function attemptLogin(){
    const u = userEl.value.trim();
    const p = passEl.value;
    msg.textContent = "";
    if(!u || !p || u !== EXPECTED_USER){ msg.textContent = "Invalid username or password."; return; }
    const h = await sha256Hex(`${u}:${p}:${SALT}`);
    if(h === EXPECTED_HASH_HEX){
      sessionStorage.setItem("auth_ok","1");
      setLocked(false);
      passEl.value = "";
    } else {
      msg.textContent = "Invalid username or password.";
    }
  }
  submitBtn.addEventListener("click", attemptLogin);
  passEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") attemptLogin(); });

  logoutBtn.addEventListener("click", ()=>{
    sessionStorage.removeItem("auth_ok");
    setLocked(true);
    userEl.value=""; passEl.value=""; msg.textContent="";
  });

  addr.textContent = "/";
  renderTree();
  renderRows();

  const authed = sessionStorage.getItem("auth_ok")==="1";
  setLocked(!authed);
</script>
</body>
</html>
